<!-- <iframe src="http://770a5c74.ngrok.io/wx/authorize?appid=wx8447a832a5a9ebb9&redirect_uri=http%3A%2F%2F770a5c74.ngrok.io%2Fwx%2FgetCode&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect" frameborder="0"></iframe> -->
<!-- <iframe src="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx8447a832a5a9ebb9&redirect_uri=http%3A%2F%2F770a5c74.ngrok.io%2Floginjs.html&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect" frameborder="0"></iframe> -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <script>
        var __WeiXinAuth = function (name) {
            this.AppName = name;
            this.prefix = "__login_pop_";
            this.server = ' http://76a2b6d8.ngrok.io/wx/authorize';
            this.iframeUrl = ' http://76a2b6d8.ngrok.io/loginjs.html';
            this.timestamp = (new Date()).getTime();
            this.status = true;
            this.scope = 'snsapi_userinfo';  //snsapi_base ：静默授权   snsapi_userinfo：获取用户信息
            this.backurl = encodeURIComponent(location.href);
            this.beforSend = function () {
            };
            this.afterSend = function (result) {
            };
            this.callback = function (result) {
                if (result.errNum == 1) {
                    var go_url = this.server + "?type=wxlogin_jump&scope=" + this.scope + "&goback=" + this.backurl;
                    return location.href = go_url;
                }
                this.afterSend(result);
            }
            this.send = function () {
                if (this.status == true) {
                    this.timestamp = (new Date()).getTime();
                    this.status = false;
                    var protocol = window.location.protocol;
                    var domain = window.location.hostname;
                    var id = this.prefix + this.timestamp;
                    var url = this.server + "?type=wxlogin_cookie&scope=" + this.scope + "&callback=parent." + this.AppName + ".callback&goback=" + encodeURIComponent(this.iframeUrl);
                    var div = document.createElement("iframe");
                    div.setAttribute("id", id);
                    div.setAttribute("style", "display:none");
                    document.body.appendChild(div);
                    this.beforSend();
                    document.getElementById(id).src = url;
                }
                
            }
        }
        window.wx = new __WeiXinAuth('wx');
        window.wx.send();
        window.wx.afterSend = function(res) {
            var jsonData = decodeURIComponent(res.res);
            try {
               jsonData = JSON.parse(jsonData) 
            } catch (error) {
                jsonData = {}
            }
            console.log(jsonData);
        }
    </script>
</body>
</html>